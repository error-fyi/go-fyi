<!-- markdownlint-configure-file {
  "MD013": {
    "code_blocks": false,
    "tables": false
  },
  "MD033": false,
  "MD041": false
} -->

<a name="readme-top"></a>

<div align="center">

[![GitHub tag](https://img.shields.io/github/v/tag/error-fyi/go-fyi?color=green&style=for-the-badge)](https://github.com/error-fyi/go-fyi/tags)
[![Nix Devshell](https://img.shields.io/badge/nix-devshell-blue?logo=NixOS&style=for-the-badge)](https://github.com/error-fyi/go-fyi)
[![Continuous Integration](https://img.shields.io/github/actions/workflow/status/tfadeyi/errors/ci.yml?branch=main&style=for-the-badge)](https://github.com/error-fyi/go-fyi/actions/workflows/ci.yml)
[![License](https://img.shields.io/badge/License-MIT-yellowgreen.svg?style=for-the-badge)](https://github.com/tfadeyi/errors/blob/main/LICENSE)
[![Language](https://img.shields.io/github/go-mod/go-version/error-fyi/go-fyi?style=for-the-badge)](https://github.com/error-fyi/go-fyi)
[![Go Report Card](https://goreportcard.com/badge/github.com/error-fyi/go-fyi?style=for-the-badge)](https://goreportcard.com/report/github.com/error-fyi/go-fyi)

<a href="https:/docs.error.fyi/fyi">
    <img title="error.fyi" alt="Logo" src="docs/img/logo.png" width="280">
</a>

# go-fyi

<p align="center">

<a href="https://docs.error.fyi"><strong>Explore the docs Â»</strong></a>

**error.fyi's** Golang client library. It is used to wrap errors and add extra context when the error is returned.

<a href="#Installation">**Installation**</a>
Â·
<a href="https://docs.error.fyi/docs/intro">**Get Started**</a>
Â·
<a href="https://docs.error.fyi/docs/libraries/go">**Reference**</a>
Â·
<a href="https://github.com/error-fyi/go-fyi/issues">**Report Bug**</a>


</p>

</div>

---

> **Warning**
> The project is not production ready.

## Motivation â­•

When developing a software application error messages tend to be an afterthought or forgotten all together, which in turn
might make for a poor user experience when troubleshooting errors. **With error.fyi I hope to improve the story around error messaging
and troubleshooting.**

An error wrapped with `go-fyi` should always be able to answer the following:

* **What caused the issue?**
* **How they could solve the issue.**
* **What to do to solve the issue.**

## Installation ðŸ“¦

```shell
go get -u github.com/error-fyi/go-fyi
```

## Quickstart ðŸš€

> **Note**
> error.fyi CLI is required to generate the error.yaml from comments. Alternatively you can manually create your `error.yaml`.

See [Get Started](https://docs.error.fyi/docs/intro) for more information on generating the `error.yaml`.

```go
package main

import (
  "errors"
  "log"
  _"embed"

  fyi "github.com/error-fyi/go-fyi"
)

//go:embed errors.yaml
var errorsYAML []byte

// @fyi name example-app
// @fyi title Example App
// @fyi base_url docs.example.com
// @fyi version v0.1.0
func main() {
  fyi.SetManifest(errorsYAML)
  err := doSomething()
  if err != nil {
    log.Fatal(err)
  }
}

func doSomething() error {
  // TODO improve this error message
  err := errors.New("something went wrong, please try again")
  // @fyi.error code main_error_18
  // @fyi.error title Transaction Error
  // @fyi.error short There was an error during transaction, value exceeded limit
  // @fyi.error severity low
  // @fyi.error.suggestion short Retry the transaction with a lower input value
  return fyi.Error(err, "main_error_18")
}
```

Output:

```shell
$ go run main.go
2023/10/03 22:46:12 [something went wrong, please try again]

   TRANSACTION ERROR                                                          
                                                                              
  ## What caused the error                                                    
                                                                              
  There was an error during transaction, value exceeded limit                 
                                                                              
  ## Quick Solutions                                                          
                                                                              
  â”‚ Additional information is available at: docs.example.com/example-          
  â”‚ app/errors/main_error_18                                                   
                                                                              
  â€¢ Suggestion: Retry the transaction with a lower input value                

exit status 1
```

<details>
<summary>example manifest</summary>

```yaml
---
# Code generated by fyictl: https://github.com/tfadeyi/errors.
# DO NOT EDIT.
base_url: docs.example.com
errors_definitions:
    main_error_18:
        code: main_error_18
        meta:
            loc:
                filename: main.go
                line: 24
        severity: low
        short: There was an error during transaction, value exceeded limit
        suggestions:
            "1":
                error_code: main_error_18
                id: "1"
                short: Retry the transaction with a lower input value
        title: Transaction Error
name: example-app
title: Example App
version: v0.1.0
```

</details>

## Annotations

Go-fyi uses in code annotations to add context to the errors returned to users.
The list of all available annotations can be found [here](https://docs.error.fyi/docs/category/annotations).

Annotations can be added manually next to the error in the code or automatically with the aid
of [**fyictl**](https://docs.error.fyi/docs/cli/fyictl_annotate), which parses the code for errors and annotates them.

```shell
# annotates and wraps errors in the file.go
fyictl annotate -f file.go --wrap
```

```shell
# annotates and wraps errors in all the go packages under the current directory
fyictl init --recursive --wrap
```

## Examples

### Wrap error

To wrap an error with go-fyi, pass the error as the first input and the code of the error as the second argument.

>**Warning**
> Make sure the code is the same as the in code annotation.

```go
package main
import (
	"errors"
	fyi "github.com/error-fyi/go-fyi"
)
func doSomething() error {
    // TODO improve this error message
    err := errors.New("something went wrong, please try again")
    // @fyi.error code main_error_18
    // @fyi.error title Transaction Error
    // @fyi.error short There was an error during transaction, value exceeded limit
    // @fyi.error severity low
    // @fyi.error.suggestion short Retry the transaction with a lower input value
    return fyi.Error(err, "main_error_18")
}
```

### Wrap error with options

When wrapping errors with go-fyi, it's possible to customize how the target error will be displayed to the user.

```go
package main
import (
	"errors"
	fyi "github.com/error-fyi/go-fyi"
)
func doSomething() error {
    // TODO improve this error message
    err := errors.New("something went wrong, please try again")
    // @fyi.error code main_error_18
    // @fyi.error title Transaction Error
    // @fyi.error short There was an error during transaction, value exceeded limit
    // @fyi.error severity low
    // @fyi.error.suggestion short Retry the transaction with a lower input value
    return fyi.Error(
		err, "main_error_18",
		fyi.WithDisplayErrorURL(false),
		fyi.WithRenderMarkdown(false),
		)
}
```

### Global configuration

It's possible to configure go-fyi different options at a global level.

```go
package main
import (
	_"embed"
	fyi "github.com/error-fyi/go-fyi"
)

//go:embed errors.yaml
var errorsYAML []byte

// @fyi name example-app
// @fyi title Example App
// @fyi base_url docs.example.com
// @fyi version v0.1.0
func main() {
	fyi.SetManifest(errorsYAML)
	fyi.SetDisplayErrorURL(false)
	fyi.SetSilence(true)
}
```

## Development

Development is entirely done using Nix [devshell](https://numtide.github.io/devshell), as such Nix should be present in the development machine.

```shell
$ source env-dev.sh
$ develop
```

This will boot up a Nix devshell with the need tools and information.

## Contributing

Everyone is welcome to contribute to the project.

Please see [CONTRIBUTING.md](.github/CONTRIBUTING.md) for information on how to get started.

Feedback is always appreciated, whether it's a bug or feature request, feel free to open an issue using one of the templates.

## License
MIT, see [LICENSE.md](./LICENSE).
